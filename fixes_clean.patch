--- a/pipelines/build_customer_features.sql
+++ b/pipelines/build_customer_features.sql
@@
-    AVG(
-        CASE
-            WHEN p.payment_date IS NOT NULL THEN (p.payment_date - i.due_date)
-            ELSE 0
-        END
-    ) AS avg_days_late,
+    AVG(
+        CASE
+            WHEN p.payment_date IS NOT NULL
+            THEN CAST(p.payment_date AS DATE) - CAST(i.due_date AS DATE)
+            ELSE 0
+        END
+    ) AS avg_days_late,
@@
-    SUM(i.amount) AS total_billed,
-    SUM(COALESCE(p.amount_paid, 0)) AS total_paid,
+    SUM(CAST(i.amount AS double precision)) AS total_billed,
+    SUM(CAST(COALESCE(p.amount_paid, '0') AS double precision)) AS total_paid,

--- a/ingestion/generate_data.py
+++ b/ingestion/generate_data.py
@@ def main():
     customers.to_csv("data/customers.csv", index=False)
     contracts.to_csv("data/contracts.csv", index=False)
     invoices.to_csv("data/invoices.csv", index=False)
     payments.to_csv("data/payments.csv", index=False)
     
     # Explicitly format date columns for consistent loading
     for df in [invoices, payments]:
         for col in ["invoice_date", "due_date", "payment_date"]:
             df[col] = pd.to_datetime(df[col]).dt.strftime("%Y-%m-%d")

--- a/requirements.txt
+++ b/requirements.txt
@@
 pandas
 sqlalchemy
 psycopg2-binary
-xgboost
+xgboost==1.7.5
 apache-airflow==3.1.5
